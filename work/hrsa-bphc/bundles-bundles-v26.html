# file: bundles-v26.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Configuration Hub</title>
  <style>
    :root {
      --brand-blue: #1589ee;
      --dark-blue: #16325c;
      --light-gray: #f4f6f9;
      --border-gray: #d8dde6;
      --text-dark: #1a1a1a;
      --text-light: #63737a;
      --font: Arial, sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: var(--font); background: var(--light-gray); color: var(--text-dark); }
    .app-container { display: flex; flex-direction: column; height: 100%; }
    header { background: var(--dark-blue); color: white; padding: 0 1em; display: flex; align-items: center; height: 50px; justify-content: space-between; }
    header h1 { font-size: 1.2em; }
    .body { flex: 1; display: flex; overflow: hidden; }
    nav { width: 220px; background: var(--brand-blue); display: flex; flex-direction: column; }
    nav a { color: white; text-decoration: none; padding: 1em; }
    nav a.active, nav a:hover { background: var(--dark-blue); }
    .main { flex: 1; overflow-y: auto; padding: 1em; }
    .section { display: none; }
    .section.active { display: block; }
    .card { background: white; border: 1px solid var(--border-gray); border-radius: 4px; padding: 1em; margin-bottom: 1em; }
    h2 { margin-bottom: 0.5em; color: var(--dark-blue); }
    label { display: block; margin: 0.5em 0 0.25em; font-weight: bold; }
    input[type="text"], textarea, select, input[type="number"], input[type="date"], input[type="url"], input[type="datetime-local"] { width: 100%; padding: 0.5em; border: 1px solid var(--border-gray); border-radius: 3px; }
    textarea { resize: vertical; height: 80px; }
    button { margin-top: 0.5em; background: var(--brand-blue); color: white; border: none; padding: 0.5em 1em; border-radius: 3px; cursor: pointer; }
    button.delete { background: #d9534f; margin-left: 0.5em; }
    button.update { background: #ffc107; color: #1a1a1a; margin-left: 0.5em;}
    table { width: 100%; border-collapse: collapse; margin-top: 0.5em; }
    th, td { border: 1px solid var(--border-gray); padding: 0.5em; text-align: left; }
    th { background: var(--light-gray); }
    .search-input { width: calc(100% - 2px); margin-bottom: 0.5em; }
    .wizard-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index:100; }
    .wizard-content { background: white; padding: 1em; border-radius: 5px; width: 700px; max-height: 90%; overflow-y: auto; }
    .wizard-step { display: none; }
    .wizard-step.active { display: block; }
    .wizard-buttons { text-align: right; margin-top: 1em; }
    .wizard-buttons button { margin-left: 0.5em; }
    .order-list { list-style: none; padding: 0; }
    .order-list li { margin: 0.25em 0; display: flex; justify-content: space-between; align-items: center; background: var(--light-gray); padding: 0.5em; border-radius: 3px; }
    .order-btn { background: transparent; border: none; cursor: pointer; color: var(--brand-blue); margin-left: 0.5em; }
    .toggle-switch { position: relative; width: 50px; display: inline-block; }
    .toggle-switch input { display:none; }
    .slider { position: absolute; cursor: pointer; top:0; left:0; right:0; bottom:0; background-color: #ccc; transition:.4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left:4px; bottom:4px; background-color:white; transition:.4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--brand-blue); }
    input:checked + .slider:before { transform: translateX(26px); }
    .error { color: #d9534f; font-size: 0.9em; margin-top: 0.25em; }
    .flex { display: flex; gap:1em; }
    .flex-column { display: flex; flex-direction: column; }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <h1>Configuration Hub</h1>
      <div>User: admin | <a href="#" style="color:white;text-decoration:underline;">Logout</a></div>
    </header>
    <div class="body">
      <nav>
        <a href="#" data-target="submission-library" class="active">Submission Form Library</a>
        <a href="#" data-target="review-library">Review Form Library</a>
        <a href="#" data-target="cohorts">Cohorts</a>
        <a href="#" data-target="bundles">Submission Bundles</a>
        <a href="#" data-target="rbundles">Review Bundles</a>
        <a href="#" data-target="deliverables">Deliverables</a>
      </nav>
      <div class="main">
        <section id="submission-library" class="section active">
          <h2>Manage Submission Form Library</h2>
          <button id="open-lib-wizard">New Submission Form</button>
          <button id="delete-selected-sub">Delete Selected</button>
          <div class="card">
            <label for="submission-grid-search">Search Forms</label>
            <input type="text" id="submission-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead>
                <tr>
                  <th><input type="checkbox" id="sub-select-all"></th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Endpoint URL</th>
                  <th>Exit Event</th>
                  <th>API Auth Type</th>
                  <th>API Features</th>
                  <th>Schema</th>
                  <th>Validation Status</th>
                  <th>Options</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="submission-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="review-library" class="section">
          <h2>Manage Review Form Library</h2>
          <button id="open-rlib-wizard">New Review Form</button>
          <button id="delete-selected-rev">Delete Selected</button>
          <div class="card">
            <label for="review-grid-search">Search Forms</label>
            <input type="text" id="review-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead>
                <tr>
                  <th><input type="checkbox" id="rev-select-all"></th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Endpoint URL</th>
                  <th>Exit Event</th>
                  <th>API Auth Type</th>
                  <th>API Features</th>
                  <th>Schema</th>
                  <th>Validation Status</th>
                  <th>Options</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="review-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="cohorts" class="section">
          <h2>Manage Cohorts</h2>
          <button id="open-cohort-wizard">New Cohort</button>
          <button id="delete-selected-cohort">Delete Selected</button>
          <div class="card">
            <table>
              <thead><tr><th><input type="checkbox" id="cohort-select-all"></th><th>Name</th><th>Description</th><th>Tags</th><th>Program</th><th>Resource Type</th><th># Resources</th><th>Actions</th></tr></thead>
              <tbody id="cohort-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="bundles" class="section">
          <h2>Manage Submission Bundles</h2>
          <button id="open-bundle-wizard">New Bundle</button>
          <button id="delete-selected-bundle">Delete Selected</button>
          <div class="card">
            <label for="bundle-grid-search">Search Bundles</label>
            <input type="text" id="bundle-grid-search" class="search-input" placeholder="Search bundles...">
            <table>
              <thead><tr><th><input type="checkbox" id="bundle-select-all"></th><th>Name</th><th>Description</th><th>Program</th><th>Tags</th><th># Submission Forms</th><th>Review Enabled</th><th># Review Forms</th><th>Actions</th></tr></thead>
              <tbody id="bundle-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="rbundles" class="section">
          <h2>Manage Review Bundles</h2>
          <button id="open-rbundle-wizard">New Review Bundle</button>
          <button id="delete-selected-rbundle">Delete Selected</button>
          <div class="card">
            <label for="rbundle-grid-search">Search Bundles</label>
            <input type="text" id="rbundle-grid-search" class="search-input" placeholder="Search bundles...">
            <table>
              <thead><tr><th><input type="checkbox" id="rbundle-select-all"></th><th>Name</th><th>Description</th><th>Program</th><th>Tags</th><th># Submission Forms</th><th>Review Enabled</th><th># Review Forms</th><th>Actions</th></tr></thead>
              <tbody id="rbundle-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="deliverables" class="section">
          <h2>Manage Deliverables</h2>
          <button id="open-deliverable-wizard">New Deliverable</button>
          <button id="delete-selected-del">Delete Selected</button>
          <div class="card">
            <label for="deliverable-grid-search">Search Deliverables</label>
            <input type="text" id="deliverable-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead><tr><th><input type="checkbox" id="del-select-all"></th><th>Name</th><th>Cohort</th><th>Bundle</th><th>Schedule</th><th>Next Run</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody id="deliverable-grid"></tbody>
            </table>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Submission Form Wizard -->
  <div id="lib-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="lib-wizard-title">New Submission Form</h3>
      <div id="lib-step-1" class="wizard-step active">
        <h4>Step 1: Metadata</h4>
        <div class="flex-column">
          <label for="lib-name">Name *</label>
          <input type="text" id="lib-name"><span class="error" id="lib-name-error"></span>
          <label for="lib-desc">Description</label>
          <textarea id="lib-desc"></textarea>
          <label for="lib-endpoint">Endpoint URL *</label>
          <input type="url" id="lib-endpoint"><span class="error" id="lib-endpoint-error"></span>
          <label for="lib-exit">Exit Event</label>
          <input type="text" id="lib-exit">
          <label for="lib-auth">Auth Type *</label>
          <select id="lib-auth"><option value="">Select</option><option>API Key</option><option>OAuth2</option></select><span class="error" id="lib-auth-error"></span>
          <label>API Features</label>
          <table id="lib-features-table">
            <thead>
              <tr><th>Feature</th><th>Verb</th><th>Endpoint</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <label for="lib-schema">Schema *</label>
          <select id="lib-schema"><option value="">Select</option><option>schema1.json</option><option>schema2.json</option></select><span class="error" id="lib-schema-error"></span>
        </div>
      </div>
      <div id="lib-step-2" class="wizard-step">
        <h4>Step 2: Validation</h4>
        <p>Review metadata and run validation tests:</p>
        <div id="lib-review"></div>
        <button id="lib-run-tests">Run Validation Tests</button>
        <div id="lib-test-status"></div>
      </div>
      <div class="wizard-buttons">
        <button id="lib-cancel">Cancel</button>
        <button id="lib-prev" style="display:none;">Prev</button>
        <button id="lib-next">Next</button>
        <button id="lib-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- Review Form Wizard -->
  <div id="rlib-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="rlib-wizard-title">New Review Form</h3>
      <div id="rlib-step-1" class="wizard-step active">
        <h4>Step 1: Metadata</h4>
        <div class="flex-column">
          <label for="rlib-name">Name *</label>
          <input type="text" id="rlib-name"><span class="error" id="rlib-name-error"></span>
          <label for="rlib-desc">Description</label>
          <textarea id="rlib-desc"></textarea>
          <label for="rlib-endpoint">Endpoint URL *</label>
          <input type="url" id="rlib-endpoint"><span class="error" id="rlib-endpoint-error"></span>
          <label for="rlib-exit">Exit Event</label>
          <input type="text" id="rlib-exit">
          <label for="rlib-auth">Auth Type *</label>
          <select id="rlib-auth"><option value="">Select</option><option>API Key</option><option>OAuth2</option></select><span class="error" id="rlib-auth-error"></span>
          <label>API Features</label>
          <table id="rlib-features-table">
            <thead>
              <tr><th>Feature</th><th>Verb</th><th>Endpoint</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <label for="rlib-schema">Schema *</label>
          <select id="rlib-schema"><option value="">Select</option><option>schemaA.json</option><option>schemaB.json</option></select><span class="error" id="rlib-schema-error"></span>
        </div>
      </div>
      <div id="rlib-step-2" class="wizard-step">
        <h4>Step 2: Validation</h4>
        <p>Review metadata and run validation tests:</p>
        <div id="rlib-review"></div>
        <button id="rlib-run-tests">Run Validation Tests</button>
        <div id="rlib-test-status"></div>
      </div>
      <div class="wizard-buttons">
        <button id="rlib-cancel">Cancel</button>
        <button id="rlib-prev" style="display:none;">Prev</button>
        <button id="rlib-next">Next</button>
        <button id="rlib-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- Cohort Wizard -->
  <div id="cohort-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="cohort-wizard-title">New Cohort</h3>
      <div id="cohort-step-1" class="wizard-step active">
        <h4>Step 1: Basic Info</h4>
        <label for="cohort-name">Name *</label>
        <input type="text" id="cohort-name"><span class="error" id="cohort-name-error"></span>
        <label for="cohort-desc">Description</label>
        <textarea id="cohort-desc"></textarea>
        <label for="cohort-tags">Tags (comma separated)</label>
        <input type="text" id="cohort-tags">
      </div>
      <div id="cohort-step-2" class="wizard-step">
        <h4>Step 2: Program & Resource Type</h4>
        <label for="cohort-prog">Program *</label>
        <select id="cohort-prog"><option value="">Select</option><option>330</option><option>LGP</option><option>LAL</option></select><span class="error" id="cohort-prog-error"></span>
        <label for="cohort-type">Resource Type *</label>
        <select id="cohort-type"><option value="">Select</option><option>applications</option><option>awards</option><option>organizations</option></select><span class="error" id="cohort-type-error"></span>
      </div>
      <div id="cohort-step-3" class="wizard-step">
        <h4>Step 3: Pick Resources</h4>
        <label for="cohort-entities-search">Search Resources</label>
        <input type="text" id="cohort-entities-search" class="search-input">
        <div class="flex">
          <div style="flex:1;">
            <h5>Available</h5>
            <ul id="cohort-entities-available" class="order-list"></ul>
          </div>
          <div style="flex:1;">
            <h5>Selected</h5>
            <ul id="cohort-entities-selected" class="order-list"></ul>
          </div>
        </div>
      </div>
      <div id="cohort-step-4" class="wizard-step">
        <h4>Step 4: Review & Finish</h4>
        <div id="cohort-summary"></div>
      </div>
      <div class="wizard-buttons">
        <button id="cohort-cancel">Cancel</button>
        <button id="cohort-prev" style="display:none;">Prev</button>
        <button id="cohort-next">Next</button>
        <button id="cohort-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- Bundle Wizard -->
  <div id="bundle-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="bundle-wizard-title">New Submission Bundle</h3>
      <div id="bundle-step-1" class="wizard-step active">
        <h4>Step 1: Basics</h4>
        <label for="bundle-name">Name *</label>
        <input type="text" id="bundle-name"><span class="error" id="bundle-name-error"></span>
        <label for="bundle-desc">Description</label>
        <textarea id="bundle-desc"></textarea>
        <label for="bundle-prog">Program *</label>
        <select id="bundle-prog"><option value="">Select</option><option>BPHC</option><option>HAB</option><option>LGP</option><option>LAL</option></select><span class="error" id="bundle-prog-error"></span>
        <label for="bundle-tags">Tags (comma separated)</label>
        <input type="text" id="bundle-tags">
      </div>
      <div id="bundle-step-2" class="wizard-step">
        <h4>Step 2: Submission Phase</h4>
        <label for="bundle-sub-search">Search Submission Forms</label>
        <input type="text" id="bundle-sub-search" class="search-input">
        <div class="flex">
          <div style="flex:1;">
            <h5>Available</h5>
            <ul id="bundle-forms-available" class="order-list"></ul>
          </div>
          <div style="flex:1;">
            <h5>Selected</h5>
            <ul id="bundle-forms-selected" class="order-list"></ul>
          </div>
        </div>
      </div>
      <div id="bundle-step-3" class="wizard-step">
        <h4>Step 3: Review Phase</h4>
        <label>Enable Review?</label>
        <label class="toggle-switch"><input type="checkbox" id="bundle-review-enabled"><span class="slider"></span></label>
        <div id="bundle-review-section" style="margin-top:1em; display:none;">
          <label for="bundle-rev-search">Search Review Forms</label>
          <input type="text" id="bundle-rev-search" class="search-input">
          <div class="flex">
            <div style="flex:1;">
              <h5>Available</h5>
              <ul id="bundle-rev-available" class="order-list"></ul>
            </div>
            <div style="flex:1;">
              <h5>Selected</h5>
              <ul id="bundle-rev-selected" class="order-list"></ul>
            </div>
          </div>
        </div>
      </div>
      <div id="bundle-step-4" class="wizard-step">
        <h4>Step 4: Summary & Finish</h4>
        <div id="bundle-summary"></div>
      </div>
      <div class="wizard-buttons">
        <button id="bundle-cancel">Cancel</button>
        <button id="bundle-prev" style="display:none;">Prev</button>
        <button id="bundle-next">Next</button>
        <button id="bundle-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- existing Review Bundle & Deliverable wizards unchanged -->

  <script>
    document.querySelectorAll('nav a').forEach(a=>{
      a.onclick=e=>{
        e.preventDefault();
        document.querySelectorAll('nav a').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById(a.dataset.target).classList.add('active');
      };
    });

    const defaultFeatures = [
      {name:'Create Draft', verb:'POST', endpoint:'/api/forms'},
      {name:'Update Draft', verb:'PUT', endpoint:'/api/forms/{formId}'},
      {name:'Publish', verb:'POST', endpoint:'/api/forms/{formId}/publish'},
      {name:'List Forms', verb:'GET', endpoint:'/api/forms?type={submission|review}&status={draft|published}&page={n}&size={m}'},
      {name:'Get Form Details', verb:'GET', endpoint:'/api/forms/{formId}'},
      {name:'Delete Form', verb:'DELETE', endpoint:'/api/forms/{formId}'},
      {name:'List Versions', verb:'GET', endpoint:'/api/forms/{formId}/versions'},
      {name:'Get Version Details', verb:'GET', endpoint:'/api/forms/{formId}/versions/{version}'},
      {name:'Restore Version', verb:'POST', endpoint:'/api/forms/{formId}/versions/{version}/restore'},
      {name:'Health', verb:'GET', endpoint:'/api/health'}
    ];
    const submissionLibrary = [
      { id:'sf1', name:'BPHC Clinic Intake', desc:'Clinic intake form for HRSA BPHC programs', endpointUrl:'/api/forms/clinic-intake', exitEvent:'onExit', authType:'API Key', apiFeatures:'Create Draft,Update Draft,Publish,List Forms,Get Form Details,Delete Form,List Versions,Get Version Details,Restore Version,Health', schema:'schema1.json', lastValidationStatus:'Passed' },
      { id:'sf2', name:'BPHC Patient Survey', desc:'Patient survey form', endpointUrl:'/api/forms/patient-survey', exitEvent:'surveyComplete', authType:'OAuth2', apiFeatures:'Create Draft,Update Draft,Publish,List Forms,Get Form Details,Delete Form,List Versions,Get Version Details,Restore Version,Health', schema:'schema2.json', lastValidationStatus:'Pending' }
    ];
    const reviewLibrary = [
      { id:'rf1', name:'BPHC Clinic Intake Review', desc:'Review form for clinic intake', endpointUrl:'/api/forms/clinic-intake/review', exitEvent:'onReviewComplete', authType:'API Key', apiFeatures:'Create Draft,Update Draft,Publish,List Forms,Get Form Details,Delete Form,List Versions,Get Version Details,Restore Version,Health', schema:'schemaA.json', lastValidationStatus:'Passed' }
    ];
    const dataStore = {};
    let cohorts = [];
    let bundles = [
      { id:"b1", name:"BPHC Submission Bundle", desc:"Bundle for BPHC community clinics", program:"BPHC", tags:"PrimaryCare,Community", submissionPhaseForms:["Clinic Intake","Patient Survey"], reviewEnabled:true, reviewPhaseForms:["Clinic Intake Review"] },
      { id:"b2", name:"HAB Assessment Bundle", desc:"HIV/AIDS Bureau assessment bundle", program:"HAB", tags:"HIV,AIDS", submissionPhaseForms:["HAB Form A"], reviewEnabled:false, reviewPhaseForms:[] },
      { id:"b3", name:"HRSA BPHC Test Bundle", desc:"Test bundle for HRSA BPHC example", program:"BPHC", tags:"HRSA,BPHC", submissionPhaseForms:["BPHC Clinic Intake","BPHC Patient Survey"], reviewEnabled:true, reviewPhaseForms:["BPHC Clinic Intake Review"] }
    ];
    let rbundles = JSON.parse(JSON.stringify(bundles));
    let deliverables = [];

    function renderGrid(grid, data, cols){
      grid.innerHTML='';
      data.forEach(item=>{
        const tr=document.createElement('tr');
        let html=`<td><input type="checkbox" data-name="${item.name}"></td>`;
        cols.forEach(c=>{
          const v=typeof c==='function'?c(item):item[c]||'';
          html+=`<td>${v}</td>`;
        });
        html+=`<td><button class="update" data-name="${item.name}">Update</button><button class="delete" data-name="${item.name}">Delete</button></td>`;
        tr.innerHTML=html; grid.appendChild(tr);
      });
    }

    // Cohorts rendering
    const cohortGrid=document.getElementById('cohort-grid'), deleteSelectedCoh=document.getElementById('delete-selected-cohort');
    function renderCohorts(){
      renderGrid(cohortGrid,cohorts,[
        'name',
        item=>item.desc,
        item=>item.tags,
        'program',
        'type',
        item=>item.entities.length
      ]);
      deleteSelectedCoh.disabled=true;
      document.getElementById('cohort-select-all').checked=false;
      cohortGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.onchange=()=>deleteSelectedCoh.disabled=!cohortGrid.querySelectorAll('input[type="checkbox"]:checked').length);
      cohortGrid.querySelectorAll('.delete').forEach(btn=>{btn.onclick=()=>{const n=btn.dataset.name;if(confirm(`Delete cohort "${n}"?`)){const i=cohorts.findIndex(x=>x.name===n);cohorts.splice(i,1);renderCohorts();}}});
      cohortGrid.querySelectorAll('.update').forEach(btn=>btn.onclick=()=>openCohortWizard('edit',btn.dataset.name));
    }
    renderCohorts();
    document.getElementById('cohort-select-all').onclick=e=>{cohortGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=e.target.checked);deleteSelectedCoh.disabled=!e.target.checked;};
    deleteSelectedCoh.onclick=()=>{
      const sel=Array.from(cohortGrid.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.dataset.name);
      if(sel.length&&confirm(`Delete ${sel.length} selected?`)){sel.forEach(n=>{const i=cohorts.findIndex(x=>x.name===n);cohorts.splice(i,1);});renderCohorts();}
    };

    // Bundles rendering & search
    const bundleGrid=document.getElementById('bundle-grid'), deleteSelectedBundle=document.getElementById('delete-selected-bundle');
    function renderBundles(){
      renderGrid(bundleGrid,bundles,[
        'name',
        item=>item.desc,
        'program',
        item=>item.tags,
        item=>item.submissionPhaseForms.length,
        item=>item.reviewEnabled?'Yes':'No',
        item=>item.reviewPhaseForms.length
      ]);
      deleteSelectedBundle.disabled=true;
      document.getElementById('bundle-select-all').checked=false;
      bundleGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.onchange=()=>deleteSelectedBundle.disabled=!bundleGrid.querySelectorAll('input[type="checkbox"]:checked').length);
      bundleGrid.querySelectorAll('.delete').forEach(btn=>{btn.onclick=()=>{const n=btn.dataset.name;if(confirm(`Delete bundle "${n}"?`)){const i=bundles.findIndex(x=>x.name===n);bundles.splice(i,1);renderBundles();}}});
      bundleGrid.querySelectorAll('.update').forEach(btn=>btn.onclick=()=>openBundleWizard('edit',btn.dataset.name));
    }
    renderBundles();
    document.getElementById('bundle-select-all').onclick=e=>{bundleGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=e.target.checked);deleteSelectedBundle.disabled=!e.target.checked;};
    deleteSelectedBundle.onclick=()=>{
      const sel=Array.from(bundleGrid.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.dataset.name);
      if(sel.length&&confirm(`Delete ${sel.length} selected?`)){sel.forEach(n=>{const i=bundles.findIndex(x=>x.name===n);bundles.splice(i,1);});renderBundles();}
    };
    document.getElementById('bundle-grid-search').oninput=()=>{
      const q=document.getElementById('bundle-grid-search').value.toLowerCase();
      Array.from(bundleGrid.children).forEach(tr=>{
        tr.style.display=tr.innerText.toLowerCase().includes(q)?'':'none';
      });
    };

    // Cohort Wizard logic (unchanged)
    let cohortState={}, cohortMode='create';
    const cwOverlay=document.getElementById('cohort-wizard-overlay');
    function openCohortWizard(mode,name){
      cohortMode=mode; cohortState={entities:[]};
      cwOverlay.style.display='flex';
      document.getElementById('cohort-wizard-title').innerText= mode==='edit'?'Edit Cohort':'New Cohort';
      showCohortStep(1);
      document.querySelectorAll('#cohort-wizard-overlay input, #cohort-wizard-overlay select, #cohort-wizard-overlay textarea').forEach(el=>el.value='');
      document.querySelectorAll('#cohort-wizard-overlay .error').forEach(e=>e.innerText='');
      document.getElementById('cohort-entities-available').innerHTML='';
      document.getElementById('cohort-entities-selected').innerHTML='';
      if(mode==='edit'){
        const item=cohorts.find(x=>x.name===name);
        cohortState=JSON.parse(JSON.stringify(item));
        document.getElementById('cohort-name').value=item.name;
        document.getElementById('cohort-desc').value=item.desc;
        document.getElementById('cohort-tags').value=item.tags;
        document.getElementById('cohort-prog').value=item.program;
        document.getElementById('cohort-type').value=item.type;
        populateCohortEntities();
        item.entities.forEach(e=>addListItem('cohort-entities-selected',e,true));
      }
    }
    document.getElementById('open-cohort-wizard').onclick=()=>openCohortWizard('create');
    document.getElementById('cohort-cancel').onclick=()=>cwOverlay.style.display='none';
    function showCohortStep(n){
      cwOverlay.querySelectorAll('.wizard-step').forEach((el,i)=>el.classList.toggle('active',i+1===n));
      document.getElementById('cohort-prev').style.display=n>1?'inline-block':'none';
      document.getElementById('cohort-next').style.display=n<4?'inline-block':'none';
      document.getElementById('cohort-finish').style.display=n===4?'inline-block':'none';
      cwOverlay.dataset.step=n;
      if(n===3) populateCohortEntities();
      if(n===4) showCohortSummary();
    }
    document.getElementById('cohort-next').onclick=()=>{
      let step=parseInt(cwOverlay.dataset.step), ok=true;
      if(step===1){
        if(!document.getElementById('cohort-name').value.trim()){document.getElementById('cohort-name-error').innerText='Required'; ok=false;} else document.getElementById('cohort-name-error').innerText='';
      }
      if(step===2){
        if(!document.getElementById('cohort-prog').value){document.getElementById('cohort-prog-error').innerText='Required'; ok=false;} else document.getElementById('cohort-prog-error').innerText='';
        if(!document.getElementById('cohort-type').value){document.getElementById('cohort-type-error').innerText='Required'; ok=false;} else document.getElementById('cohort-type-error').innerText='';
      }
      if(ok){
        if(step===1){
          cohortState.name=document.getElementById('cohort-name').value.trim();
          cohortState.desc=document.getElementById('cohort-desc').value;
          cohortState.tags=document.getElementById('cohort-tags').value;
        }
        if(step===2){
          cohortState.program=document.getElementById('cohort-prog').value;
          cohortState.type=document.getElementById('cohort-type').value;
        }
        showCohortStep(step+1);
      }
    };
    document.getElementById('cohort-prev').onclick=()=>showCohortStep(parseInt(cwOverlay.dataset.step)-1);
    function populateCohortEntities(){
      const avail=document.getElementById('cohort-entities-available');
      avail.innerHTML='';
      const prog=cohortState.program||document.getElementById('cohort-prog').value;
      const type=cohortState.type||document.getElementById('cohort-type').value;
      if(dataStore[prog] && dataStore[prog][type]){
        dataStore[prog][type].forEach(e=>addListItem('cohort-entities-available',e,false));
      }
    }
    document.getElementById('cohort-entities-search').oninput=()=>{
      const q=document.getElementById('cohort-entities-search').value.toLowerCase();
      Array.from(document.getElementById('cohort-entities-available').children).forEach(li=>{
        li.style.display=li.dataset.value.toLowerCase().includes(q)?'flex':'none';
      });
    };
    function addListItem(listId,text,selected){
      const ul=document.getElementById(listId);
      if(Array.from(ul.children).some(li=>li.dataset.value===text)) return;
      const li=document.createElement('li');
      li.dataset.value=text; li.innerHTML=`<span>${text}</span><button class="order-btn">${selected?'−':'+'}</button>`;
      ul.appendChild(li);
      li.querySelector('button').onclick=()=>{
        li.remove();
        const target=listId==='cohort-entities-available'?'cohort-entities-selected':'cohort-entities-available';
        addListItem(target,text, target==='cohort-entities-selected');
      };
    }
    function showCohortSummary(){
      const sum=document.getElementById('cohort-summary');
      sum.innerHTML=`
        <p><strong>Name:</strong> ${cohortState.name}</p>
        <p><strong>Description:</strong> ${cohortState.desc}</p>
        <p><strong>Tags:</strong> ${cohortState.tags}</p>
        <p><strong>Program:</strong> ${cohortState.program}</p>
        <p><strong>Resource Type:</strong> ${cohortState.type}</p>
        <p><strong>Resources:</strong> ${Array.from(document.getElementById('cohort-entities-selected').children).map(li=>li.dataset.value).join(', ')}</p>`;
    }
    document.getElementById('cohort-finish').onclick=()=>{
      cohortState.entities=Array.from(document.getElementById('cohort-entities-selected').children).map(li=>li.dataset.value);
      cohortState.id=cohortMode==='create'?Date.now().toString():cohortState.id;
      if(cohortMode==='create') cohorts.push(cohortState);
      cwOverlay.style.display='none'; renderCohorts();
    };

    // Bundle Wizard logic
    let bundleState={}, bundleMode='create';
    const bwOverlay=document.getElementById('bundle-wizard-overlay');
    function openBundleWizard(mode,name){
      bundleMode=mode; bundleState={submissionPhaseForms:[], reviewPhaseForms:[]};
      bwOverlay.style.display='flex';
      document.getElementById('bundle-wizard-title').innerText= mode==='edit'?'Edit Submission Bundle':'New Submission Bundle';
      showBundleStep(1);
      document.querySelectorAll('#bundle-wizard-overlay input, #bundle-wizard-overlay select, #bundle-wizard-overlay textarea').forEach(el=>{ if(el.type==='checkbox') el.checked=false; else el.value=''; });
      document.querySelectorAll('#bundle-wizard-overlay .error').forEach(e=>e.innerText='');
      ['bundle-forms-available','bundle-forms-selected','bundle-rev-available','bundle-rev-selected'].forEach(id=>document.getElementById(id).innerHTML='');
      if(mode==='edit'){
        const item=bundles.find(x=>x.name===name);
        bundleState=JSON.parse(JSON.stringify(item));
        document.getElementById('bundle-name').value=item.name;
        document.getElementById('bundle-desc').value=item.desc;
        document.getElementById('bundle-prog').value=item.program;
        document.getElementById('bundle-tags').value=item.tags;
      }
    }
    document.getElementById('open-bundle-wizard').onclick=()=>openBundleWizard('create');
    document.getElementById('bundle-cancel').onclick=()=>bwOverlay.style.display='none';
    function showBundleStep(n){
      bwOverlay.querySelectorAll('.wizard-step').forEach((el,i)=>el.classList.toggle('active',i+1===n));
      document.getElementById('bundle-prev').style.display=n>1?'inline-block':'none';
      document.getElementById('bundle-next').style.display=n<4?'inline-block':'none';
      document.getElementById('bundle-finish').style.display=n===4?'inline-block':'none';
      bwOverlay.dataset.step=n;
      if(n===2) populateBundleForms();
      if(n===3){
        const revSec=document.getElementById('bundle-review-section');
        revSec.style.display=document.getElementById('bundle-review-enabled').checked?'block':'none';
        populateBundleReviewForms();
      }
      if(n===4) showBundleSummary();
    }
    document.getElementById('bundle-next').onclick=()=>{
      let step=parseInt(bwOverlay.dataset.step), ok=true;
      if(step===1){
        if(!document.getElementById('bundle-name').value.trim()){document.getElementById('bundle-name-error').innerText='Required'; ok=false;} else document.getElementById('bundle-name-error').innerText='';
        if(!document.getElementById('bundle-prog').value){document.getElementById('bundle-prog-error').innerText='Required'; ok=false;} else document.getElementById('bundle-prog-error').innerText='';
      }
      if(ok){
        if(step===1){
          bundleState.name=document.getElementById('bundle-name').value.trim();
          bundleState.desc=document.getElementById('bundle-desc').value;
          bundleState.program=document.getElementById('bundle-prog').value;
          bundleState.tags=document.getElementById('bundle-tags').value;
        }
        if(step===2){
          bundleState.submissionPhaseForms=Array.from(document.getElementById('bundle-forms-selected').children).map(li=>li.dataset.value);
        }
        if(step===3){
          bundleState.reviewEnabled=document.getElementById('bundle-review-enabled').checked;
          if(bundleState.reviewEnabled){
            bundleState.reviewPhaseForms=Array.from(document.getElementById('bundle-rev-selected').children).map(li=>li.dataset.value);
          } else bundleState.reviewPhaseForms=[];
        }
        showBundleStep(step+1);
      }
    };
    document.getElementById('bundle-prev').onclick=()=>showBundleStep(parseInt(bwOverlay.dataset.step)-1);
    document.getElementById('bundle-review-enabled').onchange=()=>{ showBundleStep(3); };
    function populateBundleForms(){
      const avail=document.getElementById('bundle-forms-available');
      avail.innerHTML='';
      submissionLibrary.forEach(f=>addBundleItem('bundle-forms-available',f.name,false,'bundle-forms-selected'));
    }
    document.getElementById('bundle-sub-search').oninput=()=>{
      const q=document.getElementById('bundle-sub-search').value.toLowerCase();
      Array.from(document.getElementById('bundle-forms-available').children).forEach(li=>{
        li.style.display=li.dataset.value.toLowerCase().includes(q)?'flex':'none';
      });
    };
    function populateBundleReviewForms(){
      const avail=document.getElementById('bundle-rev-available');
      avail.innerHTML='';
      reviewLibrary.forEach(f=>addBundleItem('bundle-rev-available',f.name,false,'bundle-rev-selected'));
    }
    document.getElementById('bundle-rev-search').oninput=()=>{
      const q=document.getElementById('bundle-rev-search').value.toLowerCase();
      Array.from(document.getElementById('bundle-rev-available').children).forEach(li=>{
        li.style.display=li.dataset.value.toLowerCase().includes(q)?'flex':'none';
      });
    };
    function addBundleItem(listId,text,selected,targetId){
      const ul=document.getElementById(listId);
      if(Array.from(ul.children).some(li=>li.dataset.value===text)) return;
      const li=document.createElement('li');
      li.dataset.value=text;
      li.innerHTML=`<span>${text}</span><button class="order-btn">${selected?'−':'+'}</button>`;
      ul.appendChild(li);
      li.querySelector('button').onclick=()=>{
        li.remove();
        const dest = listId===targetId?listId: listId.replace(/available$/, 'selected');
        addBundleItem(dest,text,true);
      };
    }
    function showBundleSummary(){
      const sum=document.getElementById('bundle-summary');
      sum.innerHTML=`
        <p><strong>Name:</strong> ${bundleState.name}</p>
        <p><strong>Description:</strong> ${bundleState.desc}</p>
        <p><strong>Program:</strong> ${bundleState.program}</p>
        <p><strong>Tags:</strong> ${bundleState.tags}</p>
        <p><strong>Submission Forms:</strong> ${bundleState.submissionPhaseForms.join(', ')}</p>
        <p><strong>Review Enabled:</strong> ${bundleState.reviewEnabled?'Yes':'No'}</p>
        <p><strong>Review Forms:</strong> ${bundleState.reviewPhaseForms.join(', ')}</p>`;
    }
    document.getElementById('bundle-finish').onclick=()=>{
      bundleState.id=bundleMode==='create'?Date.now().toString():bundleState.id;
      if(bundleMode==='create') bundles.push(bundleState);
      bwOverlay.style.display='none';
      renderBundles();
    };

    // Remaining wizards unchanged...
  </script>
</body>
</html>
