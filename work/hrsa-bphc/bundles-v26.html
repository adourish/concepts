# file: bundles-v25.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Configuration Hub</title>
  <style>
    :root {
      --brand-blue: #1589ee;
      --dark-blue: #16325c;
      --light-gray: #f4f6f9;
      --border-gray: #d8dde6;
      --text-dark: #1a1a1a;
      --text-light: #63737a;
      --font: Arial, sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: var(--font); background: var(--light-gray); color: var(--text-dark); }
    .app-container { display: flex; flex-direction: column; height: 100%; }
    header { background: var(--dark-blue); color: white; padding: 0 1em; display: flex; align-items: center; height: 50px; justify-content: space-between; }
    header h1 { font-size: 1.2em; }
    .body { flex: 1; display: flex; overflow: hidden; }
    nav { width: 220px; background: var(--brand-blue); display: flex; flex-direction: column; }
    nav a { color: white; text-decoration: none; padding: 1em; }
    nav a.active, nav a:hover { background: var(--dark-blue); }
    .main { flex: 1; overflow-y: auto; padding: 1em; }
    .section { display: none; }
    .section.active { display: block; }
    .card { background: white; border: 1px solid var(--border-gray); border-radius: 4px; padding: 1em; margin-bottom: 1em; }
    h2 { margin-bottom: 0.5em; color: var(--dark-blue); }
    label { display: block; margin: 0.5em 0 0.25em; font-weight: bold; }
    input[type="text"], textarea, select, input[type="number"], input[type="date"], input[type="url"], input[type="datetime-local"] { width: 100%; padding: 0.5em; border: 1px solid var(--border-gray); border-radius: 3px; }
    textarea { resize: vertical; height: 80px; }
    button { margin-top: 0.5em; background: var(--brand-blue); color: white; border: none; padding: 0.5em 1em; border-radius: 3px; cursor: pointer; }
    button.delete { background: #d9534f; margin-left: 0.5em; }
    button.update { background: #ffc107; color: #1a1a1a; margin-left: 0.5em;}
    table { width: 100%; border-collapse: collapse; margin-top: 0.5em; }
    th, td { border: 1px solid var(--border-gray); padding: 0.5em; text-align: left; }
    th { background: var(--light-gray); }
    .search-input { width: calc(100% - 2px); margin-bottom: 0.5em; }
    .wizard-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index:100; }
    .wizard-content { background: white; padding: 1em; border-radius: 5px; width: 700px; max-height: 90%; overflow-y: auto; }
    .wizard-step { display: none; }
    .wizard-step.active { display: block; }
    .wizard-buttons { text-align: right; margin-top: 1em; }
    .wizard-buttons button { margin-left: 0.5em; }
    .order-list { list-style: none; padding: 0; }
    .order-list li { margin: 0.25em 0; display: flex; justify-content: space-between; align-items: center; background: var(--light-gray); padding: 0.5em; border-radius: 3px; }
    .order-btn { background: transparent; border: none; cursor: pointer; color: var(--brand-blue); margin-left: 0.5em; }
    .error { color: #d9534f; font-size: 0.9em; margin-top: 0.25em; }
    .flex { display: flex; gap:1em; }
    .flex-column { display: flex; flex-direction: column; }
    .toggle-switch { position: relative; width: 50px; display: inline-block; }
    .toggle-switch input { display:none; }
    .slider { position: absolute; cursor: pointer; top:0; left:0; right:0; bottom:0; background-color: #ccc; transition:.4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left:4px; bottom:4px; background-color:white; transition:.4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--brand-blue); }
    input:checked + .slider:before { transform: translateX(26px); }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <h1>Configuration Hub</h1>
      <div>User: admin | <a href="#" style="color:white;text-decoration:underline;">Logout</a></div>
    </header>
    <div class="body">
      <nav>
        <a href="#" data-target="tenants">Tenants</a>
        <a href="#" data-target="entities">Entities</a>
        <a href="#" data-target="submission-library" class="active">Submission Form Library</a>
        <a href="#" data-target="review-library">Review Form Library</a>
        <a href="#" data-target="cohorts">Cohorts</a>
        <a href="#" data-target="bundles">Submission Bundles</a>
        <a href="#" data-target="rbundles">Review Bundles</a>
        <a href="#" data-target="deliverables">Deliverables</a>
      </nav>
      <div class="main">
        <section id="tenants" class="section">
          <h2>Manage Tenants</h2>
          <button id="open-tenant-wizard">New Tenant</button>
          <button id="delete-selected-tenant">Delete Selected</button>
          <div class="card">
            <label for="tenant-grid-search">Search Tenants</label>
            <input type="text" id="tenant-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead><tr><th><input type="checkbox" id="tenant-select-all"></th><th>Name</th><th>Description</th><th>Actions</th></tr></thead>
              <tbody id="tenant-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="entities" class="section">
          <h2>Manage Entities</h2>
          <button id="open-entity-wizard">New Entity Definition</button>
          <button id="delete-selected-entity">Delete Selected</button>
          <div class="card">
            <label for="entity-grid-search">Search Entities</label>
            <input type="text" id="entity-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead><tr><th><input type="checkbox" id="entity-select-all"></th><th>Name</th><th>Type</th><th>Parent Entity</th><th># Child Entities</th><th>Actions</th></tr></thead>
              <tbody id="entity-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="submission-library" class="section active">
          <h2>Manage Submission Form Library</h2>
          <button id="open-lib-wizard">New Submission Form</button>
          <button id="delete-selected-sub">Delete Selected</button>
          <div class="card">
            <label for="submission-grid-search">Search Forms</label>
            <input type="text" id="submission-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead>
                <tr>
                  <th><input type="checkbox" id="sub-select-all"></th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Endpoint URL</th>
                  <th>Exit Event</th>
                  <th>API Auth Type</th>
                  <th>API Features</th>
                  <th>Schema</th>
                  <th>Validation Status</th>
                  <th>Options</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="submission-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="review-library" class="section">
          <h2>Manage Review Form Library</h2>
          <button id="open-rlib-wizard">New Review Form</button>
          <button id="delete-selected-rev">Delete Selected</button>
          <div class="card">
            <label for="review-grid-search">Search Forms</label>
            <input type="text" id="review-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead>
                <tr>
                  <th><input type="checkbox" id="rev-select-all"></th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Endpoint URL</th>
                  <th>Exit Event</th>
                  <th>API Auth Type</th>
                  <th>API Features</th>
                  <th>Schema</th>
                  <th>Validation Status</th>
                  <th>Options</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="review-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="cohorts" class="section">
          <h2>Manage Cohorts</h2>
          <button id="open-cohort-wizard">New Cohort</button>
          <button id="delete-selected-cohort">Delete Selected</button>
          <div class="card">
            <table>
              <thead><tr><th><input type="checkbox" id="cohort-select-all"></th><th>Name</th><th>Description</th><th>Tags</th><th>Program</th><th>Entity Type</th><th># Entities</th><th>Actions</th></tr></thead>
              <tbody id="cohort-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="bundles" class="section">
          <h2>Manage Submission Bundles</h2>
          <button id="open-bundle-wizard">New Bundle</button>
          <button id="delete-selected-bundle">Delete Selected</button>
          <div class="card">
            <label for="bundle-grid-search">Search Bundles</label>
            <input type="text" id="bundle-grid-search" class="search-input" placeholder="Search bundles...">
            <table>
              <thead><tr><th><input type="checkbox" id="bundle-select-all"></th><th>Name</th><th>Description</th><th>Program</th><th>Tags</th><th># Submission Forms</th><th>Review Enabled</th><th># Review Forms</th><th>Actions</th></tr></thead>
              <tbody id="bundle-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="rbundles" class="section">
          <h2>Manage Review Bundles</h2>
          <button id="open-rbundle-wizard">New Review Bundle</button>
          <button id="delete-selected-rbundle">Delete Selected</button>
          <div class="card">
            <label for="rbundle-grid-search">Search Bundles</label>
            <input type="text" id="rbundle-grid-search" class="search-input" placeholder="Search bundles...">
            <table>
              <thead><tr><th><input type="checkbox" id="rbundle-select-all"></th><th>Name</th><th>Description</th><th>Program</th><th>Tags</th><th># Submission Forms</th><th>Review Enabled</th><th># Review Forms</th><th>Actions</th></tr></thead>
              <tbody id="rbundle-grid"></tbody>
            </table>
          </div>
        </section>
        <section id="deliverables" class="section">
          <h2>Manage Deliverables</h2>
          <button id="open-deliverable-wizard">New Deliverable</button>
          <button id="delete-selected-del">Delete Selected</button>
          <div class="card">
            <label for="deliverable-grid-search">Search Deliverables</label>
            <input type="text" id="deliverable-grid-search" class="search-input" placeholder="Search...">
            <table>
              <thead><tr><th><input type="checkbox" id="del-select-all"></th><th>Name</th><th>Cohort</th><th>Bundle</th><th>Schedule</th><th>Next Run</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody id="deliverable-grid"></tbody>
            </table>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Tenant Wizard -->
  <div id="tenant-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="tenant-wizard-title">New Tenant</h3>
      <div id="tenant-step-1" class="wizard-step active">
        <h4>Step 1: Basic Info</h4>
        <label for="tenant-name">Name *</label>
        <input type="text" id="tenant-name"><span class="error" id="tenant-name-error"></span>
        <label for="tenant-desc">Description</label>
        <textarea id="tenant-desc"></textarea>
      </div>
      <div id="tenant-step-2" class="wizard-step">
        <h4>Step 2: Review & Finish</h4>
        <div id="tenant-summary"></div>
      </div>
      <div class="wizard-buttons">
        <button id="tenant-cancel">Cancel</button>
        <button id="tenant-prev" style="display:none;">Prev</button>
        <button id="tenant-next">Next</button>
        <button id="tenant-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- Entity Definition Wizard -->
  <div id="entity-wizard-overlay" class="wizard-overlay">
    <div class="wizard-content">
      <h3 id="entity-wizard-title">New Entity Definition</h3>
      <div id="entity-step-1" class="wizard-step active">
        <h4>Step 1: Basic Info</h4>
        <label for="entity-name">Name *</label>
        <input type="text" id="entity-name"><span class="error" id="entity-name-error"></span>
        <label for="entity-type">Type *</label>
        <select id="entity-type"><option value="">Select</option><option>system</option><option>user</option></select><span class="error" id="entity-type-error"></span>
      </div>
      <div id="entity-step-2" class="wizard-step">
        <h4>Step 2: Hierarchy</h4>
        <label for="entity-parent">Parent Entity</label>
        <select id="entity-parent"><option value="">None</option></select>
      </div>
      <div id="entity-step-3" class="wizard-step">
        <h4>Step 3: Attributes</h4>
        <button id="entity-add-attr">+ Add Field</button>
        <table id="entity-attrs-table">
          <thead><tr><th>Name</th><th>Data Type</th><th>Required</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="entity-step-4" class="wizard-step">
        <h4>Step 4: Review & Finish</h4>
        <div id="entity-summary"></div>
      </div>
      <div class="wizard-buttons">
        <button id="entity-cancel">Cancel</button>
        <button id="entity-prev" style="display:none;">Prev</button>
        <button id="entity-next">Next</button>
        <button id="entity-finish" style="display:none;">Finish</button>
      </div>
    </div>
  </div>

  <!-- Existing wizards and script omitted for brevity; they remain unchanged -->

  <script>
    document.querySelectorAll('nav a').forEach(a=>{
      a.onclick=e=>{
        e.preventDefault();
        document.querySelectorAll('nav a').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById(a.dataset.target).classList.add('active');
      };
    });

    // Data stores
    let tenants = [];
    let entities = [];

    // Common renderGrid for simple tables
    function renderGrid(grid, data, cols){
      grid.innerHTML='';
      data.forEach(item=>{
        const tr=document.createElement('tr');
        let html=`<td><input type="checkbox" data-name="${item.name}"></td>`;
        cols.forEach(c=>{
          const v=typeof c==='function'?c(item):item[c]||'';
          html+=`<td>${v}</td>`;
        });
        html+=`<td><button class="update" data-name="${item.name}">Update</button><button class="delete" data-name="${item.name}">Delete</button></td>`;
        tr.innerHTML=html; grid.appendChild(tr);
      });
    }

    // Tenants section
    const tenantGrid=document.getElementById('tenant-grid'),
          tenantSearch=document.getElementById('tenant-grid-search'),
          deleteSelectedTenant=document.getElementById('delete-selected-tenant');
    function renderTenants(){
      const q=tenantSearch.value.toLowerCase();
      const filtered=tenants.filter(t=>t.name.toLowerCase().includes(q));
      renderGrid(tenantGrid,filtered,['name', item=>item.description]);
      deleteSelectedTenant.disabled=true;
      document.getElementById('tenant-select-all').checked=false;
      tenantGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.onchange=()=>deleteSelectedTenant.disabled=!tenantGrid.querySelectorAll('input[type="checkbox"]:checked').length);
      tenantGrid.querySelectorAll('.delete').forEach(btn=>btn.onclick=()=>{
        const n=btn.dataset.name;
        if(confirm(`Delete tenant "${n}"?`)){
          tenants.splice(tenants.findIndex(x=>x.name===n),1);
          renderTenants();
        }
      });
      tenantGrid.querySelectorAll('.update').forEach(btn=>btn.onclick=()=>openTenantWizard('edit',btn.dataset.name));
    }
    tenantSearch.oninput=renderTenants;
    document.getElementById('tenant-select-all').onclick=e=>{
      tenantGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=e.target.checked);
      deleteSelectedTenant.disabled=!e.target.checked;
    };
    deleteSelectedTenant.onclick=()=>{
      const sel=Array.from(tenantGrid.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.dataset.name);
      if(sel.length && confirm(`Delete ${sel.length} selected?`)){
        sel.forEach(n=>tenants.splice(tenants.findIndex(x=>x.name===n),1));
        renderTenants();
      }
    };
    renderTenants();

    // Tenant Wizard logic
    let tenantState={}, tenantMode='create';
    const twOverlay=document.getElementById('tenant-wizard-overlay');
    function openTenantWizard(mode,name){
      tenantMode=mode; tenantState={};
      twOverlay.style.display='flex';
      document.getElementById('tenant-wizard-title').innerText= mode==='edit'?'Edit Tenant':'New Tenant';
      showTenantStep(1);
      document.getElementById('tenant-name').value='';
      document.getElementById('tenant-desc').value='';
      document.getElementById('tenant-name-error').innerText='';
      if(mode==='edit'){
        const item=tenants.find(x=>x.name===name);
        tenantState={...item};
        document.getElementById('tenant-name').value=item.name;
        document.getElementById('tenant-desc').value=item.description;
      }
    }
    document.getElementById('open-tenant-wizard').onclick=()=>openTenantWizard('create');
    document.getElementById('tenant-cancel').onclick=()=>twOverlay.style.display='none';
    function showTenantStep(n){
      twOverlay.querySelectorAll('.wizard-step').forEach((el,i)=>el.classList.toggle('active', i+1===n));
      document.getElementById('tenant-prev').style.display=n>1?'inline-block':'none';
      document.getElementById('tenant-next').style.display=n<2?'inline-block':'none';
      document.getElementById('tenant-finish').style.display=n===2?'inline-block':'none';
      twOverlay.dataset.step=n;
    }
    document.getElementById('tenant-next').onclick=()=>{
      let ok=true;
      const name=document.getElementById('tenant-name').value.trim();
      if(!name){document.getElementById('tenant-name-error').innerText='Required'; ok=false;} else document.getElementById('tenant-name-error').innerText='';
      if(ok){
        tenantState.name=name;
        tenantState.description=document.getElementById('tenant-desc').value;
        document.getElementById('tenant-summary').innerHTML=`
          <p><strong>Name:</strong> ${tenantState.name}</p>
          <p><strong>Description:</strong> ${tenantState.description}</p>`;
        showTenantStep(2);
      }
    };
    document.getElementById('tenant-prev').onclick=()=>showTenantStep(1);
    document.getElementById('tenant-finish').onclick=()=>{
      if(tenantMode==='create'){
        tenantState.id=Date.now().toString();
        tenants.push(tenantState);
      } else {
        const idx=tenants.findIndex(x=>x.id===tenantState.id);
        tenants[idx]=tenantState;
      }
      twOverlay.style.display='none';
      renderTenants();
    };

    // Entities section
    const entityGrid=document.getElementById('entity-grid'),
          entitySearch=document.getElementById('entity-grid-search'),
          deleteSelectedEntity=document.getElementById('delete-selected-entity');
    function renderEntities(){
      const q=entitySearch.value.toLowerCase();
      const filtered=entities.filter(e=>e.name.toLowerCase().includes(q));
      entityGrid.innerHTML='';
      filtered.forEach(item=>{
        const tr=document.createElement('tr');
        const childCount=entities.filter(x=>x.parentId===item.id).length;
        const parentName=(entities.find(x=>x.id===item.parentId)||{}).name||'';
        tr.innerHTML=`
          <td><input type="checkbox" data-name="${item.name}"></td>
          <td>${item.name}</td>
          <td>${item.type}</td>
          <td>${parentName}</td>
          <td>${childCount}</td>
          <td><button class="update" data-name="${item.name}">Update</button><button class="delete" data-name="${item.name}">Delete</button></td>`;
        entityGrid.appendChild(tr);
      });
      deleteSelectedEntity.disabled=true;
      document.getElementById('entity-select-all').checked=false;
      entityGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.onchange=()=>deleteSelectedEntity.disabled=!entityGrid.querySelectorAll('input[type="checkbox"]:checked').length);
      entityGrid.querySelectorAll('.delete').forEach(btn=>btn.onclick=()=>{
        const n=btn.dataset.name;
        if(confirm(`Delete entity "${n}"?`)){
          const idx=entities.findIndex(x=>x.name===n);
          entities.splice(idx,1);
          renderEntities();
        }
      });
      entityGrid.querySelectorAll('.update').forEach(btn=>btn.onclick=()=>openEntityWizard('edit',btn.dataset.name));
    }
    entitySearch.oninput=renderEntities;
    document.getElementById('entity-select-all').onclick=e=>{
      entityGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=e.target.checked);
      deleteSelectedEntity.disabled=!e.target.checked;
    };
    deleteSelectedEntity.onclick=()=>{
      const sel=Array.from(entityGrid.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.dataset.name);
      if(sel.length&&confirm(`Delete ${sel.length} selected?`)){
        sel.forEach(n=>entities.splice(entities.findIndex(x=>x.name===n),1));
        renderEntities();
      }
    };
    renderEntities();

    // Entity Wizard logic
    let entityState={}, entityMode='create';
    const ewOverlay=document.getElementById('entity-wizard-overlay');
    function openEntityWizard(mode,name){
      entityMode=mode; entityState={attributes:[]};
      ewOverlay.style.display='flex';
      document.getElementById('entity-wizard-title').innerText= mode==='edit'?'Edit Entity':'New Entity Definition';
      showEntityStep(1);
      document.getElementById('entity-name').value='';
      document.getElementById('entity-type').value='';
      document.getElementById('entity-name-error').innerText='';
      document.getElementById('entity-type-error').innerText='';
      document.getElementById('entity-parent').innerHTML='<option value="">None</option>';
      const parentSelect=document.getElementById('entity-parent');
      entities.forEach(e=>parentSelect.add(new Option(e.name,e.id)));
      document.querySelector('#entity-attrs-table tbody').innerHTML='';
      if(mode==='edit'){
        const item=entities.find(x=>x.name===name);
        entityState={...item};
        document.getElementById('entity-name').value=item.name;
        document.getElementById('entity-type').value=item.type;
        document.getElementById('entity-parent').value=item.parentId||'';
        item.attributes.forEach(attr=>addAttrRow(attr));
      }
    }
    document.getElementById('open-entity-wizard').onclick=()=>openEntityWizard('create');
    document.getElementById('entity-cancel').onclick=()=>ewOverlay.style.display='none';
    function showEntityStep(n){
      ewOverlay.querySelectorAll('.wizard-step').forEach((el,i)=>el.classList.toggle('active', i+1===n));
      document.getElementById('entity-prev').style.display=n>1?'inline-block':'none';
      document.getElementById('entity-next').style.display=n<4?'inline-block':'none';
      document.getElementById('entity-finish').style.display=n===4?'inline-block':'none';
      ewOverlay.dataset.step=n;
      if(n===4) showEntitySummary();
    }
    document.getElementById('entity-next').onclick=()=>{
      let step=parseInt(ewOverlay.dataset.step), ok=true;
      if(step===1){
        const name=document.getElementById('entity-name').value.trim();
        const type=document.getElementById('entity-type').value;
        if(!name){document.getElementById('entity-name-error').innerText='Required'; ok=false;} else document.getElementById('entity-name-error').innerText='';
        if(!type){document.getElementById('entity-type-error').innerText='Required'; ok=false;} else document.getElementById('entity-type-error').innerText='';
        if(ok){
          entityState.name=name;
          entityState.type=type;
        }
      }
      if(step===2){
        entityState.parentId=document.getElementById('entity-parent').value;
      }
      if(step===3){
        const rows=Array.from(document.querySelectorAll('#entity-attrs-table tbody tr'));
        entityState.attributes=rows.map(tr=>({
          name: tr.querySelector('.attr-name').value.trim(),
          dataType: tr.querySelector('.attr-type').value,
          required: tr.querySelector('.attr-required').checked
        }));
      }
      if(ok) showEntityStep(step+1);
    };
    document.getElementById('entity-prev').onclick=()=>showEntityStep(parseInt(ewOverlay.dataset.step)-1);
    document.getElementById('entity-add-attr').onclick=()=>{
      addAttrRow({name:'',dataType:'string',required:false});
    };
    function addAttrRow(attr){
      const tb=document.querySelector('#entity-attrs-table tbody');
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><input type="text" class="attr-name" value="${attr.name}"></td>
        <td><select class="attr-type"><option>string</option><option>number</option><option>boolean</option><option>date</option><option>enum</option></select></td>
        <td><input type="checkbox" class="attr-required" ${attr.required?'checked':''}></td>
        <td>
          <button class="order-btn up">↑</button>
          <button class="order-btn down">↓</button>
          <button class="order-btn delete-attr">×</button>
        </td>`;
      tb.appendChild(tr);
      tr.querySelector('.attr-type').value=attr.dataType;
      tr.querySelector('.delete-attr').onclick=()=>tr.remove();
      tr.querySelector('.up').onclick=()=>{
        const prev=tr.previousElementSibling;
        if(prev) tb.insertBefore(tr,prev);
      };
      tr.querySelector('.down').onclick=()=>{
        const next=tr.nextElementSibling;
        if(next) tb.insertBefore(next,tr);
      };
    }
    function showEntitySummary(){
      const sum=document.getElementById('entity-summary');
      const parentName=(entities.find(x=>x.id===entityState.parentId)||{}).name||'None';
      const attrs=entityState.attributes.map(a=>`${a.name} (${a.dataType}${a.required?', required':''})`).join('<br>');
      sum.innerHTML=`
        <p><strong>Name:</strong> ${entityState.name}</p>
        <p><strong>Type:</strong> ${entityState.type}</p>
        <p><strong>Parent:</strong> ${parentName}</p>
        <p><strong>Attributes:</strong><br>${attrs}</p>`;
    }
    document.getElementById('entity-finish').onclick=()=>{
      if(entityMode==='create'){
        entityState.id=Date.now().toString();
        entities.push(entityState);
      } else {
        const idx=entities.findIndex(x=>x.id===entityState.id);
        entities[idx]=entityState;
      }
      ewOverlay.style.display='none';
      renderEntities();
    };

    // Existing script for other sections continues unchanged...
  </script>
</body>
</html>